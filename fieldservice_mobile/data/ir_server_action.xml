<odoo>

    <record id="fsm_order_stage_started" model="ir.actions.server">
        <field name="name">FSM Order Stage Started</field>
        <field name="model_id" ref="fieldservice.model_fsm_order"/>
        <field name="state">code</field>
        <field name="code">records.write(
  {'date_start': datetime.datetime.now(),
  'fsm_stage_history_ids': [(0, 0, {'start_datetime': datetime.datetime.now(), 'stage_id': records.stage_id.id, 'duration': 0.0, 'total_duration': 0.0
  })]})</field>
    </record>

    <record id="fsm_order_stage_break" model="ir.actions.server">
        <field name="name">FSM Order Stage Break</field>
        <field name="model_id" ref="fieldservice.model_fsm_order"/>
        <field name="state">code</field>
        <field name="code">stage_rec = env['fsm.stage.history'].search([('order_id', '=', records.id)], order='id desc', limit=1)
start_date = stage_rec.start_datetime
end_date = datetime.datetime.now()
delta = end_date - start_date
duration = round((delta.total_seconds() / 3600), 2)
records.write(
  {'fsm_stage_history_ids': [(0, 0, {'start_datetime': datetime.datetime.now(), 'stage_id': records.stage_id.id, 'duration': duration, 'total_duration': round((duration + stage_rec.total_duration), 2)
  })]})</field>
    </record>

    <record id="fsm_order_stage_resume" model="ir.actions.server">
        <field name="name">FSM Order Stage Resume</field>
        <field name="model_id" ref="fieldservice.model_fsm_order"/>
        <field name="state">code</field>
        <field name="code">stage_rec = env['fsm.stage.history'].search([('order_id', '=', records.id)], order='id desc', limit=1)
records.write(
  {'fsm_stage_history_ids': [(0, 0, {'start_datetime': datetime.datetime.now(), 'stage_id': records.stage_id.id, 'duration': 0.0, 'total_duration': round((records.duration + stage_rec.total_duration), 2)
  })]})</field>
    </record>

    <record id="fsm_order_stage_completed" model="ir.actions.server">
        <field name="name">FSM Order Stage Completed</field>
        <field name="model_id" ref="fieldservice.model_fsm_order"/>
        <field name="state">code</field>
        <field name="code">stage_rec = env['fsm.stage.history'].search([('order_id', '=', records.id)], order='id desc', limit=1)
start_date = stage_rec.start_datetime
end_date = datetime.datetime.now()
delta = end_date - start_date
duration = round((delta.total_seconds() / 3600), 2)
records.write(
  {'date_end': datetime.datetime.now(),
    'fsm_stage_history_ids': [(0, 0, {'start_datetime': datetime.datetime.now(), 'stage_id': records.stage_id.id, 'duration': duration, 'total_duration': round((duration + stage_rec.total_duration), 2)
  })]})</field>
    </record>

</odoo>
